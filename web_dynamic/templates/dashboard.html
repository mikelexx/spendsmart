{% extends 'base.html' %}
{% block links %}
<link type="text/css" href="../static/styles/dashboard.css?{{ cache_id }}" rel="stylesheet">
<script src="../static/scripts/dashboard.js?{{ cache_id }}"></script>
<script defer>
  const show_less = "{{ url_for('main.dashboard') }}";
</script>
{% endblock %}
	{% block content %}
	{% with messages = get_flashed_messages() %}
{% if messages %}
{% for message in messages %}
<div class="toast">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}
	<section class="analytics">
		{% for collection in collections %}
		<div class="category-card">
			<img class="category-image" src="../static/images/bill.svg">
			<div class="overview">
				<div class="status">
					<span>Max limit</span>
					<strong>{{collection.limit }}</strong>
				</div>
				<div class="percentage">
					<div class="outer">
						<div class="inner">
							<div class="percent">{{ collection.percentage_spent }} %</div>
						</div>
					</div>
					<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="80px" height="80px">
						<defs>
						<linearGradient id="GradientColor">
						<stop offset="0%" stop-color="#e91e63" />
						<stop offset="100%" stop-color="#673ab7" />
						</linearGradient>
						</defs>
						<circle cx="40" cy="40" r="35" stroke-linecap="round" />
					</svg>

				</div>
			</div>
			<h3>{{ collection.name }}</h3>
			<div class="analytics-card" class="hidden">
					<button id="close-analytics">Close</button>
					<h2>Entertainment Summary</h2>
					<p><strong>Total Budget:</strong> $500</p>
					<p><strong>Amount Spent:</strong> $465</p>
					<p><strong>Amount Remaining:</strong> $35</p>
					<p><strong>Percentage Spent:</strong> 93%</p>
					<p><strong>End Date:</strong> 30th June 2024</p>
					<p><strong>Average Daily Spend:</strong> $15.50</p>
					<h3>Recent Transactions</h3>
					<ul>
						<li>19th June 2024 - $18 - Movie Ticket</li>
						<li>18th June 2024 - $25 - Concert</li>
						<li>15th June 2024 - $60 - Dinner Out</li>
					</ul>
					<span>Re-Track</span>
					<span>Close</span>
					<span>Un-Track</span>
			</div>
		</div>
		{% endfor -%}

	</section>
	<h2>Recent Purchases</h2>
	<section class="purchases-container">
		<table>
			<tr>
				<th>Expense</th>
				<th>Amount</th>
				<th>Category</th>
			</tr>
			{% for expense in expenses %}
			<tr>
				<td>{{ expense.name }}</td>
				<td>{{ expense.price }}</td>
				{%- set ns = namespace(collection_name='none') -%}
				{%- for collection in collections -%}
					{%- if collection.id == expense.collection_id -%}
						{%- set ns.collection_name = collection.name -%}
					{%- endif -%}
				{%- endfor -%}
				<td id="">{{ns.collection_name }}</td>
			</tr>
			{% endfor %}
		</table>
		<a id="show-all" href="{{ url_for('main.show_all_purchases') }}">Show all</a>
	</section>
	{% endblock %}
